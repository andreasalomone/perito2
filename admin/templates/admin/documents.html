{% extends "admin/base.html" %}

{% block title %}Document Inspector{% endblock %}

{% block content %}
<h1 class="mt-4">Document Inspector</h1>
<p>Browse and inspect all documents processed by the system.</p>

<div class="card shadow mb-4">
    <div class="card-header py-3">
        <h6 class="m-0 font-weight-bold text-primary">Document Logs</h6>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
                <thead>
                    <tr>
                        <th>Filename</th>
                        <th>Type</th>
                        <th>Size</th>
                        <th>Status</th>
                        <th>Extracted Length</th>
                        <th>Report</th>
                    </tr>
                </thead>
                <tbody>
                    {% for doc in pagination.items %}
                    <tr>
                        <td>{{ doc.original_filename }}</td>
                        <td>{{ doc.file_type or 'N/A' }}</td>
                        <td>{{ '%.2f'|format(doc.file_size_bytes / 1024) }} KB</td>
                        <td>
                            <span
                                class="badge bg-{{ 'success' if doc.extraction_status.value == 'success' else 'danger' if doc.extraction_status.value == 'error' else 'warning' }}">
                                {{ doc.extraction_status.value|upper }}
                            </span>
                            {% if doc.error_message %}
                            <i class="bi bi-info-circle text-danger" title="{{ doc.error_message }}"
                                data-bs-toggle="tooltip"></i>
                            {% endif %}
                        </td>
                        <td>{{ doc.extracted_content_length }} chars</td>
                        <td>
                            <a href="{{ url_for('admin_bp.report_detail', report_id=doc.report_id) }}"
                                class="btn btn-primary btn-sm">View Report</a>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="6" class="text-center">No documents found in the database.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Pagination Links -->
        <nav aria-label="Page navigation">
            <ul class="pagination justify-content-center">
                {% if pagination.has_prev %}
                <li class="page-item"><a class="page-link"
                        href="{{ url_for('admin_bp.documents', page=pagination.prev_num) }}">Previous</a></li>
                {% else %}
                <li class="page-item disabled"><a class="page-link" href="#">Previous</a></li>
                {% endif %}

                {% for page_num in pagination.iter_pages() %}
                {% if page_num %}
                {% if pagination.page == page_num %}
                <li class="page-item active"><a class="page-link" href="#">{{ page_num }}</a></li>
                {% else %}
                <li class="page-item"><a class="page-link" href="{{ url_for('admin_bp.documents', page=page_num) }}">{{
                        page_num }}</a></li>
                {% endif %}
                {% else %}
                <li class="page-item disabled"><span class="page-link">...</span></li>
                {% endif %}
                {% endfor %}

                {% if pagination.has_next %}
                <li class="page-item"><a class="page-link"
                        href="{{ url_for('admin_bp.documents', page=pagination.next_num) }}">Next</a></li>
                {% else %}
                <li class="page-item disabled"><a class="page-link" href="#">Next</a></li>
                {% endif %}
            </ul>
        </nav>
    </div>
</div>

<script>
    // Initialize tooltips
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl)
    })
</script>
{% endblock %}